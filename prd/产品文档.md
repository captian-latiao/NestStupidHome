| 项目名称 | Nest (Home Digital Twin) |
| --- | --- |
| **版本号** | v1.0 |
| **文档状态** | **已定稿 (去 AI 化 / 离线版)** |
| **核心理念** | 离线优先，确定性算法，家庭数字孪生 |
| **最后更新** | 2026-02-07 |

---

# 1. 平台核心骨架 (Platform Core Architecture)

## 1.1 设计原则

Nest v1.0 采用 **Local-First (本地优先)** 架构。

- **离线可用 (Offline Capability):** 所有的核心业务逻辑（预测、状态更新、数据记录）必须在客户端（App）本地完成计算。网络仅用于数据备份与多端同步。
- **确定性算法 (Deterministic Logic):** 严禁使用不可控的生成式内容。所有数据分析基于明确的数学模型与规则引擎。
- **模块化单体:** 各个业务模块（如水管家）逻辑解耦，但打包在同一个 App 客户端内。

## 1.2 角色与权限 (RBAC)

| 角色 (Role) | 权限描述 |
| --- | --- |
| **Admin (管理员)** | 负责家庭成员管理、云端数据备份开关、导出调试数据。 |
| **User (家庭成员)** | 负责日常使用、查看仪表盘、本地参数配置（如修改最大水位）。 |

## 1.3 信息架构 (IA)

1. **主控仪表盘 (Master Dashboard):**
    - **全域状态:** 本地存储的全局变量 (在/离家、睡眠状态)。
    - **服务卡片流:** 仅展示计算结果 (e.g., "水充足", "需打扫")。
    - **每日晨报:** 基于昨日本地数据统计生成的固定格式报告 (e.g., "昨日用水 2L，达标")。
2. **服务详情页:** 展示本地数据库中的详细图表与操作。

# 2. 产品概述 (Product Overview)

## 2.1 产品愿景

Nest 旨在构建一个运行在用户口袋里的“家庭数字孪生体”。通过严谨的算法模型，实时计算家庭资源的消耗速率，为用户提供**无需联网即可查看**的状态快照与行动建议。

## 2.2 核心价值

- **零阻力录入:** 以“换水”等关键动作作为算法锚点，极大降低用户记录成本。
- **算法预测:** 利用时间衰减算法与生物钟逻辑，在本地实时推演资源剩余情况。
- **规则反馈:** 通过预设的规则引擎，根据数据状态匹配最贴切的管家提示语。

---

# 3. 功能模块

## 3.1 首页数据面板 (Dashboard)

**定位：** 全局信息的“驾驶舱”，只展示结果和核心行动点，不展示复杂图表。

### 3.1.1 核心指标卡片 (Key Metrics Cards)

以“磁贴”形式展示各业务模块的实时状态快照。

- **饮用水卡片:**
    - 展示：当前剩余百分比 + 剩余时间估算（e.g., "75% | 约 2 天"）。
    - 状态色：蓝 (正常) / 红 (缺水)。
    - *点击跳转至数字孪生业务详情页。*
- **库存卡片:**
    - 展示：低库存物品数量（e.g., "3 项物品需补货"）或 "库存充足"。
    - *点击跳转至数字孪生业务-消耗品库存页。*
- **环境/清洁卡片:**
    - 展示：全屋整洁度评分（e.g., "85分 | 3天未打扫"）。

### 3.1.2 智能管家提示 (Smart Butler)

- 管家角色：军军（猫）
- **晨报 (Morning Brief):** 每日首次打开 App 时展示。
    - *内容例：* “早上好，Admin。昨晚大家睡得不错。饮用水充足，但在库存中检测到洗衣液即将用完。”
- **异常预警 (Alerts):**
    - *内容例：* “检测到饮水消耗速度异常（过快），家里来了客人吗？”

## 3.2 数字孪生业务 (Digital Twin Services)

**定位：** 具体的业务执行单元，包含详细的数据记录、算法推演和图表分析。

### 3.2.1 饮用水管理 (Water Steward)

[3.2.1 饮用水管理](https://www.notion.so/3-2-1-2e175f6b65d58058b9ecc7c370c8a7ad?pvs=21)

### 3.2.2 消耗品库存 (Inventory)

[库存管理模块 (Inventory)](https://www.notion.so/Inventory-30075f6b65d5804fafd6dcc4f76f6481?pvs=21)

### 3.2.3 正计时类业务

[清洁管理](https://www.notion.so/2f575f6b65d580f1b628eeb0a35e177c?pvs=21)

[宠物护理](https://www.notion.so/2f575f6b65d5808a97b3ea1e94622bfe?pvs=21)

## 3.3 用户信息管理 (User & Family)

**定位：** 平台的基础数据层，其配置参数直接作为因子参与业务模块的算法计算。

### 3.3.1 个人信息 (Profile)

- **基础字段:** 昵称、头像 (本地存储)。
- **偏好设置:** 主题色、通知权限。

### 3.3.2 家庭管理 (Family Manager) - *核心逻辑源*

### 成员管理

- 角色划分
    - 管理员-一家之主
    - 用户-饭醉分子
    - 宠物-仅作为数据容器 (Avatar, Name, Species)。
- **功能:** 管理员可新增/删除家庭成员。
- **逻辑影响 (Crucial Logic):**
    - 系统维护一个全局变量 `family_member_count` (默认=1)。
    - **饮水模块影响:**
        - **基准日消耗量 (Benchmark):** `2.0L * family_member_count`。
        - *场景:* 当家庭人数从 1 变 2 时，系统会自动调整“标准流速”参考线，并可能重置当前的习惯学习模型。
    - **库存模块影响:**
        - 物品消耗速度预估系数 = `family_member_count`。
    - 宠物护理影响：
        - **显隐逻辑:** `pet_count > 0` 时显示宠物模块。
        - **参数注入:** `pet_count` 注入到 `PetCare` 模块计算 LoadFactor。

### 家庭作息 (Family Schedule)

- **功能:** 设定全家通用的作息时间（暂不支持分成员设定）。
- **字段:**
    - `sleep_window_start`: 默认 23:00。
    - `sleep_window_end`: 默认 07:00。
- **逻辑影响:**
    - **饮水模块:** 决定了“推演预测”逻辑中，哪些时间段会暂停扣减水位。
    - **通知逻辑:** 决定了“免打扰时段”，在此期间禁止发送非紧急通知。

## 版本记录 (Version History)

| 日期 | 版本 | 内容 |
| --- | --- | --- |
| **2025-01-01** | v0.1.1225 | 确立 Nest 概念，完成水管家基础逻辑验证。 |
| **2025-01-05** | v0.1.0117 | 确定“前端轻量化 + 后端 AI 化”架构。 |
| **2025-01-09** | v0.1.0119 | **架构升级**：引入模块化单体与双角色权限。
**逻辑重构**：水管家引入生物钟预测、动态校准与异常熔断机制。 |
| **2026-01-26** | v0.2.0126 | **结构重构：** 划分为首页、业务、用户三层结构。
**逻辑升级：** 引入家庭人数与作息作为业务算法的核心参数因子。 |
| **2026-01-27** | v0.3.0127 | 新增清洁与空间管理 |
| **2026-01-27** | v0.4.0127 | 新增宠物护理 |
| 2026-02-07 | v0.5.0207 | 新增库存管理 |