# 1. 概述

**"对抗熵增 (Fighting Entropy)"**

Nest 将家视为一个有生命体的系统。随着时间推移，数字孪生体（UI 卡片）会模拟物理世界的“老化/变脏”过程。用户的清洁行为不仅是完成任务，更是让家“焕然一新 (Restore)”的仪式。

# 2. 业务逻辑 (Business Logic)

## 2.1 核心算法：熵增进度 (Entropy Progress)

本模块采用**正计时**逻辑，计算物品自上次打扫后的“腐败”程度。

- **计算公式**:
$$Progress = \frac{\text{CurrentTime} - \text{LastCleanedTime}}{\text{BaseThreshold} / \text{LoadFactor}}$$
- **负载系数 (Load Factor)**:
    - 默认为 `1.0`。
    - **动态调整**: 若 `household_size > 2`，则所有标记为 `is_public_area` (公共区域) 的物品，系数设为 `1.2`（即变脏速度加快 20%）。

## 2.2 状态分级 (Status Grading)

根据 $Progress$ 值判定当前状态：

| 状态 (Status) | 进度范围 (Progress) | 定义 |
| --- | --- | --- |
| **✨ 清新 (Fresh)** | $0.0 - 0.5$ | 刚打扫完，状态完美。 |
| **😶 积累 (Normal)** | $0.5 - 1.0$ | 正常使用痕迹，无需立刻处理。 |
| **🍂 需维护 (Dusty)** | $1.0 - 1.5$ | 达到建议清洁周期，建议维护。 |
| **🌫️ 积灰 (Messy)** | $> 1.5$ | 严重超期，亟待关注。 |

# 3. 数据定义 (Data Schema v0.3)

| 资产类型 (Category) | 默认阈值 (Days) | 属性 | 备注 |
| --- | --- | --- | --- |
| **灶台 (Stove)** | 2 | 公共 | 高频油污重灾区 |
| **地板吸尘 (Floor Vac)** | 3 | 公共 | 毛发与浮尘 |
| **马桶 (Toilet)** | 7 | 公共 | 细菌敏感区 |
| **地板拖地 (Floor Mop)** | 7 | 公共 | 深度清洁 |
| **床上四件套 (Bedding)** | 14 | 私有 | 贴身接触 |
| **洗衣机自清洁 (Washer)** | 30 | 公共 | **NEW** 桶自洁模式 |
| **空调滤网 (AC Filter)** | 90 | 公共 | **NEW** 换季/积灰清理 |
| **窗帘 (Curtain)** | 180 | 公共 | 极低频长尾任务 |

# 4. 视觉与交互设计 (Visual & Interaction)

## 4.1 核心特性：视觉老化 (Visual Aging Effect)

这是本模块的体验灵魂。卡片 UI 随 `Progress` 动态渲染，模拟物理世界的陈旧感。

- **Overlay View**: 在卡片层之上覆盖一层遮罩层。
- **透明度 (Opacity)**: 随进度从 0% 线性渐变到 40% (Max 0.6)。
- **纹理映射 (Texture Logic)**:
    - **Phase 1 (Progress < 1.0)**: 叠加淡淡的“灰尘颗粒 (Noise Texture)”。
    - **Phase 2 (Progress >= 1.0)**: 叠加明显的“斑点/污渍 (Grunge/Spot Texture)”，整体色调微暗/泛黄。

## 4.2 列表页文案：亲切化 (Friendly Tone)

摒弃警告式文案，采用拟人化关怀语气。

| 状态 | 视觉表现 | 文案示例 (Copywriting) |
| --- | --- | --- |
| **Fresh** | 亮白底色 + 闪光 Icon | "干净得在发光 ✨" / "刚刚好" |
| **Normal** | 正常底色 | "上次打扫是 3 天前" |
| **Dusty** | 出现轻微灰尘纹理 | "好像该照顾一下了 🌱" / "有点想念你" |
| **Messy** | 明显斑点 + 灰暗底色 | "这里需要一次大扫除 🛁" / "焕新一下心情吧" |

## 4.3 核心交互：一键焕新 (The Sparkle Reset)

- **触发**: 点击卡片上的“✨ 完成”按钮。
- **动画序列 (Animation Sequence)**:
    1. **Flash**: 卡片瞬间高亮（白屏闪烁 0.1s）。
    2. **Cleanse**: 灰尘/斑点纹理层以圆形扩散方式消失（Mask Reveal 动画），露出底下原本鲜亮的颜色。
    3. **Particles**: 爆出微小的星星/气泡粒子效果。
    4. **Feedback**: 弹出轻提示 "又是崭新的一天！"。

# 5. 技术架构要求 (Technical Constraints)

- **Local-First**: 所有计算（天数差值、阈值判断）必须在客户端实时计算，不依赖后端。
- **Logic Encapsulation**: 必须封装为 Hooks 或 Service（如 `useHygieneLogic`）。
    - 输入：上次打扫时间戳、基准阈值、当前家庭人数。
    - 输出：当前状态枚举、进度百分比、透明度值、纹理类型。
- **iOS Portability**: 核心计算函数需标记 `// [PORTABLE]`，以便未来移植到 Widget。

# 6. 验收标准 (Acceptance Criteria)

1. **视觉测试**: 手动修改系统时间，确认卡片是否会随时间推移逐渐“变灰/变脏”。
2. **交互测试**: 点击清洁后，是否立即播放闪光特效并恢复“洁净”状态。
3. **算法测试**: 确认家庭人数设置为 3 人时，公共区域物品的建议周期是否缩短。